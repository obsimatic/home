class s{static instance;index=[];isLoaded=!1;currentLang="tr";constructor(){typeof document<"u"&&(this.currentLang=document.documentElement.lang||"tr")}static getInstance(){return s.instance||(s.instance=new s),s.instance}async init(){if(!this.isLoaded)try{const r=await fetch("/api/search-index.json");if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);this.index=await r.json(),this.isLoaded=!0}catch(r){console.error("SearchEngine init error:",r)}}getIsLoaded(){return this.isLoaded}search(r){const t=r.q.toLowerCase().trim(),i=this.index.filter(e=>{if(e.type!=="product"||t&&!`${e.id} ${e.title_tr} ${e.title_en} ${e.title_ar} ${e.brand||""}`.toLowerCase().includes(t)||r.brand.length>0&&e.brand&&!r.brand.includes(e.brand)||r.inStock&&!e.inStock)return!1;const a=e.price==="contact"||e.price==="0"||e.price===0||isNaN(Number(e.price));if(r.contactPrice){if(!a)return!1}else{if(a&&(r.minPrice>0||r.maxPrice<1/0))return!1;const c=Number(e.price)||0;if(c<r.minPrice||r.maxPrice<1/0&&c>r.maxPrice)return!1}return!0}),n=this.index.filter(e=>e.type!=="category"||!t?!1:`${e.id} ${e.title_tr} ${e.title_en} ${e.title_ar}`.toLowerCase().includes(t));return{products:i,categories:n}}getFacetedCounts(r){const t=r.q.toLowerCase().trim(),i={};return this.index.forEach(n=>{if(n.type!=="product"||!n.brand)return;let e=!0;t&&(`${n.id} ${n.title_tr} ${n.title_en} ${n.title_ar} ${n.brand||""}`.toLowerCase().includes(t)||(e=!1)),r.inStock&&!n.inStock&&(e=!1);const a=n.price==="contact"||n.price==="0"||n.price===0||isNaN(Number(n.price));if(r.contactPrice)a||(e=!1);else{a&&(r.minPrice>0||r.maxPrice<1/0)&&(e=!1);const c=Number(n.price)||0;(c<r.minPrice||r.maxPrice<1/0&&c>r.maxPrice)&&(e=!1)}e&&(i[n.brand]=(i[n.brand]||0)+1)}),i}}export{s as S};
